<Window
    x:Class="XocDiaTuLinhZoWin.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:XocDiaTuLinhZoWin"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
    Title="Xóc Đĩa Live HIT,GO88,NET88 (Automino 0978.248.822)"
    Width="1366"
    Height="768"
    Background="#F0F2F5"
    Closing="Window_Closing"
    FontFamily="Segoe UI, Segoe UI Variable, Arial"
    FontSize="14"
    Icon="pack://application:,,,/XocDiaTuLinhZoWin;component/Assets/AppIcon.ico"
    Loaded="Window_Loaded"
    SnapsToDevicePixels="True"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="ClearType"
    UseLayoutRounding="True"
    mc:Ignorable="d">

    <!--  ===================== THEME / STYLES (Facebook-like) =====================  -->
    <Window.Resources>
        <!--  Converters dùng cho ảnh  -->
        <local:SideToIconConverter x:Key="SideToIcon" />
        <local:KetQuaToIconConverter x:Key="KetQuaToIcon" />
        <local:WinLossToIconConverter x:Key="WinLossToIcon" />

        <!--  (tuỳ chọn) Brush dùng cho badge khi fallback chữ  -->
        <SolidColorBrush x:Key="WinBg" Color="#EBF5E9" />
        <SolidColorBrush x:Key="LossBg" Color="#FDECEC" />


        <!--  Palette  -->
        <SolidColorBrush x:Key="AppBg" Color="#F0F2F5" />
        <SolidColorBrush x:Key="CardBg" Color="#FFFFFF" />
        <SolidColorBrush x:Key="CardBorder" Color="#E4E6EB" />
        <SolidColorBrush x:Key="TextMain" Color="#050505" />
        <SolidColorBrush x:Key="TextSubtle" Color="#65676B" />
        <SolidColorBrush x:Key="Blue" Color="#1877F2" />
        <SolidColorBrush x:Key="BlueHover" Color="#166FE5" />
        <SolidColorBrush x:Key="BlueSoft" Color="#E7F3FF" />

        <DropShadowEffect
            x:Key="SoftShadow"
            BlurRadius="10"
            Opacity="0.07"
            ShadowDepth="0"
            Color="#000000" />

        <!--  Card  -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="14" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="Effect" Value="{StaticResource SoftShadow}" />
        </Style>

        <!--  Section title + badge  -->
        <Style x:Key="SectionHeader" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal" />
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="19" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style x:Key="Badge" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BlueSoft}" />
            <Setter Property="CornerRadius" Value="999" />
            <Setter Property="Padding" Value="8,3" />
            <Setter Property="Margin" Value="10,0,0,0" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>

        <!--  Labels nhỏ  -->
        <Style x:Key="CapsLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource Blue}" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Margin" Value="6,6,6,2" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <!--  Inputs  -->
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="6,2" />
            <Setter Property="Padding" Value="10,8" />
            <Setter Property="BorderBrush" Value="#CED0D4" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
        </Style>
        <Style TargetType="PasswordBox">
            <Setter Property="Margin" Value="6,2" />
            <Setter Property="Padding" Value="10,8" />
            <Setter Property="BorderBrush" Value="#CED0D4" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
        </Style>
        <!--  Margin chung cho ô giá trị (ComboBox/TextBox)  -->
        <Thickness x:Key="ValueFieldMargin">6,2,6,2</Thickness>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="6,8,6,0" />
            <Setter Property="Foreground" Value="{StaticResource TextSubtle}" />
        </Style>

        <!--  Primary Button (Facebook blue)  -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Blue}" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="14,10" />
            <Setter Property="MinWidth" Value="240" />
            <Setter Property="MinHeight" Value="40" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource BlueHover}" />
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.6" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  Secondary Button (neutral outline)  -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,9" />
            <Setter Property="MinWidth" Value="90" />
            <Setter Property="MinHeight" Value="36" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F5F6F7" />
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.6" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  Console (light)  -->
        <Style x:Key="ConsoleBox" TargetType="TextBox">
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="#1D2129" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="FontFamily" Value="Cascadia Code, Consolas" />
            <Setter Property="FontSize" Value="13.5" />
        </Style>

        <Style x:Key="ValueText" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
            <Setter Property="ToolTip" Value="{Binding RelativeSource={RelativeSource Self}, Path=Text}" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
            <Setter Property="FontSize" Value="15" />
        </Style>

        <SolidColorBrush x:Key="DangerRed" Color="#E53935" />

        <!--  Style chung cho checkbox đăng nhập: KHÔNG có trigger đổi màu  -->
        <Style x:Key="LoginCheckStyle" TargetType="CheckBox">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Height" Value="28" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Foreground" Value="{StaticResource TextMain}" />
            <!--  đen mặc định  -->
        </Style>

        <!--  Style riêng cho "Khoá chuột": có trigger đổi màu  -->
        <Style
            x:Key="LockMouseCheckStyle"
            BasedOn="{StaticResource LoginCheckStyle}"
            TargetType="CheckBox">
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="true">
                    <Setter Property="Foreground" Value="{StaticResource DangerRed}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  Nút đỏ dùng cho "Dừng đặt cược"  -->
        <Style
            x:Key="DangerButton"
            BasedOn="{StaticResource PrimaryButton}"
            TargetType="Button">
            <Setter Property="Background" Value="#E53935" />
            <Setter Property="BorderBrush" Value="#D32F2F" />
            <Setter Property="Foreground" Value="White" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D32F2F" />
                    <Setter Property="BorderBrush" Value="#C62828" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#B71C1C" />
                    <Setter Property="BorderBrush" Value="#B71C1C" />
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#90E53935" />
                    <Setter Property="BorderBrush" Value="#80D32F2F" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  ===== Console Blue Tint brushes & style =====  -->
        <SolidColorBrush x:Key="Log_Border" Color="#CCE0FF" />
        <SolidColorBrush x:Key="Log_HeaderBg" Color="#E7F0FF" />
        <SolidColorBrush x:Key="Log_HeaderFg" Color="#2E4A7F" />
        <SolidColorBrush x:Key="Log_Alt" Color="#F5F9FF" />

        <Style x:Key="LogGrid_BlueTint" TargetType="DataGrid">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="{StaticResource Log_Border}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="AlternationCount" Value="2" />
            <Setter Property="AlternatingRowBackground" Value="{StaticResource Log_Alt}" />
            <Setter Property="GridLinesVisibility" Value="None" />
            <Setter Property="ColumnHeaderHeight" Value="30" />
            <Setter Property="HeadersVisibility" Value="All" />
            <Setter Property="SelectionMode" Value="Single" />
            <Setter Property="SelectionUnit" Value="FullRow" />
            <Setter Property="RowStyle">
                <Setter.Value>
                    <Style TargetType="DataGridRow">
                        <Setter Property="MinHeight" Value="28" />
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{StaticResource Log_HeaderBg}" />
                        <Setter Property="Foreground" Value="{StaticResource Log_HeaderFg}" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                        <Setter Property="BorderThickness" Value="0,0,0,1" />
                        <Setter Property="BorderBrush" Value="{StaticResource Log_Border}" />
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                        <Setter Property="Padding" Value="8,6" />
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="CellStyle">
                <Setter.Value>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Padding" Value="8,4" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                        <Setter Property="VerticalContentAlignment" Value="Center" />
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>


        <!--  Faint frame (mờ, nét nhạt)  -->
        <SolidColorBrush x:Key="GhostStroke" Color="#15000000" />
        <SolidColorBrush x:Key="GhostFill" Color="#04FFFFFF" />

        <Style x:Key="GhostFrame" TargetType="Border">
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="BorderBrush" Value="{StaticResource GhostStroke}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="{StaticResource GhostFill}" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <local:ProgressWidthConverter x:Key="FillWidthConv" />

        <!--  PACK URI CHO ẢNH  -->
        <BitmapImage x:Key="ImgLE" UriSource="pack://application:,,,/Assets/side/LE.png" />
        <BitmapImage x:Key="ImgCHAN" UriSource="pack://application:,,,/Assets/side/CHAN.png" />
        <BitmapImage x:Key="ImgTHANG" UriSource="pack://application:,,,/Assets/kq/THANG.png" />
        <BitmapImage x:Key="ImgTHUA" UriSource="pack://application:,,,/Assets/kq/THUA.png" />
    </Window.Resources>

    <!--  ===================== LAYOUT =====================  -->
    <DockPanel Background="{StaticResource AppBg}">
        <!--  Menu (nhẹ, sáng)  -->
        <Menu
            Background="#FFFFFF"
            BorderBrush="{StaticResource CardBorder}"
            DockPanel.Dock="Top"
            Foreground="{StaticResource TextMain}">
            <MenuItem Header="_File">
                <MenuItem Click="OpenUrl_Click" Header="Mở URL" />
                <Separator />
                <MenuItem Click="Exit_Click" Header="Thoát" />
            </MenuItem>
            <MenuItem Header="_Run">
                <MenuItem Click="StartLoop_Click" Header="Bắt đầu" />
                <MenuItem Click="StopLoop_Click" Header="Dừng" />
            </MenuItem>
        </Menu>

        <!--  Main 8:2  -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="7*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!--  WebView  -->
            <Border
                Grid.Column="0"
                Margin="10"
                Background="Black"
                ClipToBounds="True"
                CornerRadius="10"
                Effect="{StaticResource SoftShadow}"
                SnapsToDevicePixels="True">
                <Grid>
                    <!--  Trang web  -->
                    <wv2:WebView2 x:Name="Web">
                        <wv2:WebView2.CreationProperties>
                            <wv2:CoreWebView2CreationProperties AdditionalBrowserArguments="--disable-gpu" UserDataFolder="{x:Static local:MainWindow.Wv2UserDataDir}" />
                        </wv2:WebView2.CreationProperties>
                    </wv2:WebView2>

                    <!--  Lớp phủ chặn chuột  -->
                    <Border
                        x:Name="MouseShield"
                        Panel.ZIndex="1"
                        Background="Transparent"
                        Cursor="No"
                        ToolTip="Đang khoá chuột. Bỏ tích 'Khoá chuột web' để thao tác."
                        Visibility="Visible" />
                </Grid>
            </Border>

            <!--  Splitter  -->
            <GridSplitter
                Grid.Column="0"
                Width="6"
                HorizontalAlignment="Right"
                Background="{StaticResource CardBorder}"
                ShowsPreview="True" />

            <!--  Control Panel  -->
            <Border
                Grid.Column="1"
                Margin="0,10,10,10"
                Background="{StaticResource AppBg}">
                <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <Border
                            x:Name="GroupLoginNav"
                            Style="{StaticResource Card}"
                            Visibility="Visible">
                            <StackPanel>
                                <StackPanel Style="{StaticResource SectionHeader}">
                                    <TextBlock Style="{StaticResource SectionTitle}" Text="Đăng nhập &amp; Điều hướng" />
                                    <Border Style="{StaticResource Badge}">
                                        <TextBlock
                                            FontSize="12"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource Blue}"
                                            Text="LIVE" />
                                    </Border>
                                </StackPanel>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />

                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="130" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  URL  -->
                                    <TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Style="{StaticResource CapsLabel}"
                                        Text="URL" />
                                    <TextBox
                                        x:Name="TxtUrl"
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        TextChanged="TxtUrl_TextChanged" />

                                    <!--  USER  -->
                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Style="{StaticResource CapsLabel}"
                                        Text="TÊN ĐĂNG NHẬP" />
                                    <TextBox
                                        x:Name="TxtUser"
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        TextChanged="TxtUser_TextChanged" />

                                    <!--  PASS  -->
                                    <TextBlock
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Style="{StaticResource CapsLabel}"
                                        Text="MẬT KHẨU" />
                                    <PasswordBox
                                        x:Name="TxtPass"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        PasswordChanged="TxtPass_PasswordChanged" />

                                    <!--  CHECKBOXES  -->
                                    <TextBlock
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Text="" />
                                    <Grid
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        Margin="0,6,0,0"
                                        VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <CheckBox
                                            x:Name="ChkRemember"
                                            Grid.Column="0"
                                            Style="{StaticResource LoginCheckStyle}">
                                            <TextBlock
                                                Text="Lưu tài khoản &amp; mật khẩu"
                                                TextTrimming="CharacterEllipsis"
                                                TextWrapping="NoWrap" />
                                        </CheckBox>
                                    </Grid>


                                    <!--  CONTROLS  -->
                                    <Grid
                                        Grid.Row="4"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Margin="0,6,0,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="12" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <Button
                                            x:Name="BtnVaoXocDia"
                                            Grid.Column="0"
                                            MinWidth="140"
                                            Padding="13"
                                            Click="VaoXocDia_Click"
                                            Content="Đăng Nhập &amp; Xóc Đĩa Live"
                                            Style="{StaticResource PrimaryButton}"
                                            Visibility="Visible" />



                                    </Grid>


                                </Grid>
                            </StackPanel>
                        </Border>

                        <Border
                            x:Name="GroupStrategyMoney"
                            Style="{StaticResource Card}"
                            Visibility="Collapsed">
                            <StackPanel>
                                <StackPanel Style="{StaticResource SectionHeader}">
                                    <TextBlock Style="{StaticResource SectionTitle}" Text="Chiến lược &amp; Chuỗi tiền" />
                                </StackPanel>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <!--  CHIẾN LƯỢC  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  CHI TIẾT CHIẾN LƯỢC (ẩn/hiện)  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  QUẢN LÝ VỐN  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  CHUỖI TIỀN  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  CÓ LÃI QUAY VỀ MỨC ĐẦU  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  ĐẶT KHI CÒN (GIÂY)  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  CỬA ĐẶT &amp; TỈ LỆ  -->
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="130" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <!--  CHIẾN LƯỢC (ẨN CẢ DÒNG)  -->
                                    <Grid
                                        x:Name="RowChienLuoc"
                                        Grid.Row="0"
                                        Grid.ColumnSpan="2"
                                        IsEnabled="True"
                                        Visibility="Visible">
                                        <!--  Visibility="Visible" là hiện, Visibility="Collapsed" là ẩn  -->
                                        <!--  nested grid: 2 cột label + value để giữ layout thẳng hàng  -->
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Grid.Column="0"
                                            Style="{StaticResource CapsLabel}"
                                            Text="CHIẾN LƯỢC" />

                                        <ComboBox
                                            x:Name="CmbBetStrategy"
                                            Grid.Column="1"
                                            Width="{Binding ElementName=TxtStakeCsv, Path=ActualWidth}"
                                            MinWidth="130"
                                            MinHeight="36"
                                            Margin="{StaticResource ValueFieldMargin}"
                                            Padding="10,8"
                                            HorizontalAlignment="Stretch"
                                            SelectedIndex="4">
                                            <ComboBoxItem Content="1) Chuỗi cầu C/L (chẵn/lẻ tự nhập)" />
                                            <ComboBoxItem Content="2) Thế cầu C/L (chẵn/lẻ tự nhập)" />
                                            <ComboBoxItem Content="3) Chuỗi cầu I/N (Ít/Nhiều, tự nhập)" />
                                            <ComboBoxItem Content="4) Thế cầu I/N (Ít/Nhiều, tự nhập)" />
                                            <ComboBoxItem Content="5) Bám cầu trước (thông minh)" />
                                            <ComboBoxItem Content="6) Cửa đặt ngẫu nhiên" />
                                            <ComboBoxItem Content="7) Bám cầu C/L theo thống kê AI" />
                                            <ComboBoxItem Content="8) Xu hướng chuyển trạng thái" />
                                            <ComboBoxItem Content="9) Run-length (dài-chuỗi)" />
                                            <ComboBoxItem Content="10) Chuyên gia bỏ phiếu" />
                                            <ComboBoxItem Content="11) Lịch chẻ 10 tay" />
                                            <ComboBoxItem Content="12) KNN chuỗi con" />
                                            <ComboBoxItem Content="13) Lịch hai lớp" />
                                            <ComboBoxItem Content="14) AI học tại chỗ (n-gram)" />
                                            <ComboBoxItem Content="15) AI15 – Hội đồng Chuyên gia (Top10 + Guard + Regime)" />
                                            <ComboBoxItem Content="16) Top10 tích lũy (khởi từ 50 C/L)" />
                                            <ComboBoxItem Content="17) Đánh các cửa ăn nổ hũ" />
                                        </ComboBox>
                                    </Grid>

                                    <!--  HÀNG CHI TIẾT: CHUỖI CẦU (ẩn/hiện theo chọn 1 hoặc 3)  -->
                                    <Grid
                                        x:Name="RowChuoiCau"
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Visibility="Collapsed">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock
                                            Grid.Column="0"
                                            Style="{StaticResource CapsLabel}"
                                            Text="CHUỖI CẦU" />
                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <TextBox
                                                x:Name="TxtChuoiCau"
                                                MinHeight="36"
                                                MaxHeight="120"
                                                Margin="{StaticResource ValueFieldMargin}"
                                                HorizontalAlignment="Stretch"
                                                AcceptsReturn="True"
                                                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                TextWrapping="Wrap" />
                                            <TextBlock
                                                x:Name="LblSeqError"
                                                Margin="0,2,0,0"
                                                Foreground="Red"
                                                TextWrapping="Wrap"
                                                Visibility="Collapsed" />
                                        </StackPanel>
                                    </Grid>



                                    <!--  HÀNG CHI TIẾT: CÁC THẾ CẦU (ẩn/hiện theo chọn 2 hoặc 4)  -->
                                    <Grid
                                        x:Name="RowTheCau"
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Visibility="Collapsed">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock
                                            Grid.Column="0"
                                            Style="{StaticResource CapsLabel}"
                                            Text="CÁC THẾ CẦU" />
                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <TextBox
                                                x:Name="TxtTheCau"
                                                MinHeight="36"
                                                MaxHeight="120"
                                                Margin="{StaticResource ValueFieldMargin}"
                                                HorizontalAlignment="Stretch"
                                                AcceptsReturn="True"
                                                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                TextWrapping="Wrap" />
                                            <TextBlock
                                                x:Name="LblPatError"
                                                Margin="0,2,0,0"
                                                Foreground="Red"
                                                TextWrapping="Wrap"
                                                Visibility="Collapsed" />
                                        </StackPanel>
                                    </Grid>



                                    <!--  QUẢN LÝ VỐN (ẨN CẢ DÒNG)  -->
                                    <Grid
                                        x:Name="RowQuanLyVon"
                                        Grid.Row="2"
                                        Grid.ColumnSpan="2"
                                        IsEnabled="True"
                                        Visibility="Visible">
                                        <!--  Visibility="Visible" là hiện, Visibility="Collapsed" là ẩn  -->
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Grid.Column="0"
                                            Style="{StaticResource CapsLabel}"
                                            Text="QUẢN LÝ VỐN" />

                                        <ComboBox
                                            x:Name="CmbMoneyStrategy"
                                            Grid.Column="1"
                                            Width="{Binding ElementName=TxtStakeCsv, Path=ActualWidth}"
                                            MinWidth="130"
                                            MinHeight="36"
                                            Margin="{StaticResource ValueFieldMargin}"
                                            Padding="10,8"
                                            HorizontalAlignment="Stretch"
                                            SelectedIndex="0"
                                            SelectedValuePath="Tag">
                                            <ComboBoxItem Content="1. Tăng mức tiền khi thua, thắng quay về mức đầu" Tag="IncreaseWhenLose" />
                                            <ComboBoxItem Content="2. Tăng mức tiền khi thắng, thua quay về mức ban đầu" Tag="IncreaseWhenWin" />
                                            <ComboBoxItem Content="3. Quản lý vốn Victor 2" Tag="Victor2" />
                                            <ComboBoxItem Content="4. Quản lý vốn Fibonaci ngược" Tag="ReverseFibo" />
                                            <ComboBoxItem Content="5. Quản lý vốn đa tầng" Tag="MultiChain" />
                                            <ComboBoxItem Content="6. Thua thắng đều lên mức" Tag="IncreaseEveryRound" />
                                            <ComboBoxItem Content="7. Thắng đánh lên, thua giữ nguyên mức" Tag="WinUpLoseKeep" />
                                        </ComboBox>
                                    </Grid>
                                    <!--  CHUỖI TIỀN (CSV)  -->
                                    <TextBlock
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Style="{StaticResource CapsLabel}"
                                        Text="CHUỖI TIỀN" />
                                    <TextBox
                                        x:Name="TxtStakeCsv"
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        MinHeight="36"
                                        MaxHeight="120"
                                        Margin="{StaticResource ValueFieldMargin}"
                                        HorizontalAlignment="Stretch"
                                        AcceptsReturn="True"
                                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                                        Text="1000,2000,4000,8000,16000"
                                        TextWrapping="Wrap" />

                                    <CheckBox
                                        x:Name="ChkS7ResetOnProfit"
                                        Grid.Row="4"
                                        Grid.Column="1"
                                        Margin="{StaticResource ValueFieldMargin}"
                                        VerticalAlignment="Center"
                                        Content="Có lãi quay về mức đầu"
                                        Foreground="#222"
                                        Visibility="Collapsed"
                                        Checked="ChkS7ResetOnProfit_Changed"
                                        Unchecked="ChkS7ResetOnProfit_Changed" />

                                    <!--  ĐẶT KHI CÒN (GIÂY)  -->
                                    <TextBlock
                                        Grid.Row="5"
                                        Grid.Column="0"
                                        Style="{StaticResource CapsLabel}"
                                        Text="ĐẶT KHI CÒN (GIÂY)" />
                                    <TextBox
                                        x:Name="TxtDecisionSecond"
                                        Grid.Row="5"
                                        Grid.Column="1"
                                        MinHeight="36"
                                        MaxHeight="120"
                                        Margin="{StaticResource ValueFieldMargin}"
                                        HorizontalAlignment="Stretch"
                                        Text="0" />
                                    <!--  CỬA ĐẶT &amp; TỈ LỆ  -->
                                    <Grid
                                        x:Name="RowSideRatio"
                                        Grid.Row="6"
                                        Grid.ColumnSpan="2"
                                        Visibility="Collapsed">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock
                                            Grid.Column="0"
                                            Style="{StaticResource CapsLabel}"
                                            Text="CỬA ĐẶT &amp; TỈ LỆ" />
                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBox
                                                    x:Name="TxtSideRatio"
                                                    Grid.Column="0"
                                                    MinHeight="36"
                                                    MaxHeight="120"
                                                    Margin="{StaticResource ValueFieldMargin}"
                                                    HorizontalAlignment="Stretch"
                                                    AcceptsReturn="True"
                                                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                    TextWrapping="Wrap" />
                                                <Button
                                                    x:Name="BtnResetSideRatio"
                                                    Grid.Column="1"
                                                    MinWidth="70"
                                                    Margin="8,0,0,0"
                                                    Padding="12,8"
                                                    Content="Reset"
                                                    Style="{StaticResource SecondaryButton}" />
                                            </Grid>
                                            <TextBlock
                                                x:Name="LblSideRatioError"
                                                Margin="0,2,0,0"
                                                Foreground="Red"
                                                TextWrapping="Wrap"
                                                Visibility="Collapsed" />
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <!--  HÀNG: CẮT LÃI / CẮT LỖ (đặt ngay sau hàng 'Đặt khi còn (giây)')  -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="LabelCol" />
                                        <ColumnDefinition Width="*" SharedSizeGroup="ValueCol1" />
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="LabelCol2" />
                                        <ColumnDefinition Width="*" SharedSizeGroup="ValueCol2" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        Margin="6,0,8,0"
                                        VerticalAlignment="Center"
                                        Style="{StaticResource CapsLabel}"
                                        Text="CẮT LÃI" />

                                    <TextBox
                                        x:Name="TxtCutProfit"
                                        Grid.Column="1"
                                        MinWidth="40"
                                        Margin="{StaticResource ValueFieldMargin}"
                                        HorizontalAlignment="Stretch"
                                        LostFocus="TxtCut_LostFocus" />

                                    <TextBlock
                                        Grid.Column="2"
                                        Margin="16,0,8,0"
                                        VerticalAlignment="Center"
                                        Style="{StaticResource CapsLabel}"
                                        Text="CẮT LỖ" />

                                    <TextBox
                                        x:Name="TxtCutLoss"
                                        Grid.Column="3"
                                        MinWidth="40"
                                        Margin="{StaticResource ValueFieldMargin}"
                                        HorizontalAlignment="Stretch"
                                        LostFocus="TxtCut_LostFocus" />

                                </Grid>
                                <Grid
                                    Grid.Row="0"
                                    Margin="0,10,0,0"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Nút Bắt đầu cược  -->
                                    <Button
                                        x:Name="BtnPlay"
                                        Grid.Column="0"
                                        MinWidth="140"
                                        Padding="13"
                                        Click="PlayXocDia_Click"
                                        Content="Bắt Đầu Cược"
                                        Style="{StaticResource PrimaryButton}"
                                        Visibility="Visible" />

                                    <!--  Checkbox Dùng thử  -->
                                    <CheckBox
                                        x:Name="ChkTrial"
                                        Grid.Column="1"
                                        Margin="12,0,0,0"
                                        VerticalAlignment="Center"
                                        Click="ChkTrial_Click"
                                        Content="Dùng thử">
                                        <CheckBox.Style>
                                            <Style TargetType="CheckBox">
                                                <Setter Property="Foreground" Value="#222" />
                                                <Style.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Foreground" Value="#D60000" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </CheckBox.Style>
                                    </CheckBox>

                                    <!--  Checkbox Khóa chuột  -->
                                    <CheckBox
                                        x:Name="ChkLockMouse"
                                        Grid.Column="2"
                                        Margin="12,0,0,0"
                                        VerticalAlignment="Center"
                                        Checked="ChkLockMouse_Checked"
                                        Unchecked="ChkLockMouse_Unchecked">

                                        <!--  Kế thừa style cũ, chỉ thêm đổi Content theo IsChecked  -->
                                        <CheckBox.Style>
                                            <Style BasedOn="{StaticResource LockMouseCheckStyle}" TargetType="CheckBox">
                                                <Setter Property="Content" Value="Khóa chuột" />
                                                <Style.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="Content" Value="Đang khóa chuột" />
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="False">
                                                        <Setter Property="Content" Value="Khóa chuột" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </CheckBox.Style>
                                    </CheckBox>

                                </Grid>
                                <!--  EXPIRE LABEL  -->
                                <!--  Visibility="Visible" là hiện, Visibility="Collapsed" là ẩn  -->
                                <TextBlock
                                    x:Name="LblExpire"
                                    Grid.Row="5"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Margin="4,6,0,0"
                                    HorizontalAlignment="Center"
                                    FontSize="13"
                                    Foreground="#D32F2F"
                                    Text=""
                                    TextWrapping="Wrap"
                                    Visibility="Visible" />
                            </StackPanel>
                        </Border>


                        <!--  Status  -->
                        <Border
                            x:Name="GroupStatus"
                            Style="{StaticResource Card}"
                            Visibility="Collapsed">
                            <StackPanel>

                                <!--  HEADER: StackPanel dùng SectionHeader + Grid 2 cột bằng nhau  -->
                                <!--  HEADER: StackPanel (Vertical) + Grid 2 cột bằng nhau  -->
                                <StackPanel
                                    VerticalAlignment="Center"
                                    Orientation="Vertical"
                                    Style="{StaticResource SectionHeader}">
                                    <!--  ép Vertical để con được đo theo chiều rộng container  -->
                                    <Grid HorizontalAlignment="Stretch">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="4*" />
                                            <ColumnDefinition Width="6*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Hiệu ứng blink giữ nguyên  -->
                                        <Grid.Resources>
                                            <Style x:Key="StatusBlinkStyle" TargetType="TextBlock">
                                                <Setter Property="Opacity" Value="1" />
                                                <Style.Triggers>
                                                    <Trigger Property="Visibility" Value="Visible">
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard x:Name="StatusBlinkSB">
                                                                <Storyboard RepeatBehavior="Forever">
                                                                    <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity">
                                                                        <EasingDoubleKeyFrame KeyTime="0:0:0.0" Value="1.0" />
                                                                        <EasingDoubleKeyFrame KeyTime="0:0:1.5" Value="0.2">
                                                                            <EasingDoubleKeyFrame.EasingFunction>
                                                                                <SineEase EasingMode="EaseIn" />
                                                                            </EasingDoubleKeyFrame.EasingFunction>
                                                                        </EasingDoubleKeyFrame>
                                                                        <DiscreteDoubleKeyFrame KeyTime="0:0:2.0" Value="0.2" />
                                                                        <EasingDoubleKeyFrame KeyTime="0:0:4.0" Value="1.0">
                                                                            <EasingDoubleKeyFrame.EasingFunction>
                                                                                <SineEase EasingMode="EaseOut" />
                                                                            </EasingDoubleKeyFrame.EasingFunction>
                                                                        </EasingDoubleKeyFrame>
                                                                    </DoubleAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <StopStoryboard BeginStoryboardName="StatusBlinkSB" />
                                                        </Trigger.ExitActions>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Resources>

                                        <!--  Cột 1  -->
                                        <TextBlock
                                            Grid.Column="0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource SectionTitle}"
                                            Text="Trạng thái" />

                                        <!--  Cột 2: trạng thái, căn trái  -->
                                        <TextBlock
                                            x:Name="LblStatusText"
                                            Grid.Column="1"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            FontSize="16"
                                            FontWeight="Bold"
                                            Foreground="Black"
                                            Style="{StaticResource StatusBlinkStyle}"
                                            Text=""
                                            Visibility="Collapsed" />
                                    </Grid>
                                </StackPanel>



                                <!--  (giữ nguyên phần còn lại như bạn đã có)  -->
                                <Border
                                    Margin="0,8,0,0"
                                    Padding="0"
                                    Style="{StaticResource GhostFrame}">
                                    <Border.Resources>
                                        <Style x:Key="GhostCell" TargetType="Border">
                                            <Setter Property="BorderBrush" Value="{StaticResource GhostStroke}" />
                                            <Setter Property="BorderThickness" Value="0,0,1,1" />
                                            <Setter Property="Padding" Value="6,4" />
                                            <Setter Property="SnapsToDevicePixels" Value="True" />
                                        </Style>
                                        <Style x:Key="GhostQFirst" TargetType="Border">
                                            <Setter Property="BorderBrush" Value="{StaticResource GhostStroke}" />
                                            <Setter Property="BorderThickness" Value="0,0,1,0" />
                                            <Setter Property="Padding" Value="6,4" />
                                        </Style>
                                        <Style x:Key="GhostQMid" TargetType="Border">
                                            <Setter Property="BorderBrush" Value="{StaticResource GhostStroke}" />
                                            <Setter Property="BorderThickness" Value="1,0,1,0" />
                                            <Setter Property="Padding" Value="6,4" />
                                        </Style>
                                        <Style x:Key="GhostQLast" TargetType="Border">
                                            <Setter Property="BorderBrush" Value="{StaticResource GhostStroke}" />
                                            <Setter Property="BorderThickness" Value="1,0,0,0" />
                                            <Setter Property="Padding" Value="6,4" />
                                        </Style>
                                    </Border.Resources>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="3*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Dòng 1  -->
                                        <Border
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            Style="{StaticResource GhostCell}">
                                            <TextBlock
                                                VerticalAlignment="Center"
                                                Style="{StaticResource CapsLabel}"
                                                Text="THỜI GIAN" />
                                        </Border>
                                        <Border
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            Style="{StaticResource GhostCell}">
                                            <Grid Height="16" VerticalAlignment="Center">
                                                <Border
                                                    x:Name="Track"
                                                    Height="16"
                                                    Background="#FF202020"
                                                    BorderBrush="#FF404040"
                                                    BorderThickness="1"
                                                    ClipToBounds="True"
                                                    CornerRadius="9"
                                                    SnapsToDevicePixels="True" />
                                                <Border
                                                    x:Name="Fill"
                                                    Height="16"
                                                    HorizontalAlignment="Left"
                                                    Background="#FF69C36B"
                                                    CornerRadius="9">
                                                    <Border.Width>
                                                        <MultiBinding Converter="{StaticResource FillWidthConv}">
                                                            <Binding ElementName="Track" Path="ActualWidth" />
                                                            <Binding ElementName="PrgBet" Path="Value" />
                                                            <Binding ElementName="PrgBet" Path="Minimum" />
                                                            <Binding ElementName="PrgBet" Path="Maximum" />
                                                        </MultiBinding>
                                                    </Border.Width>
                                                </Border>
                                                <ProgressBar
                                                    x:Name="PrgBet"
                                                    Maximum="1"
                                                    Minimum="0"
                                                    Visibility="Collapsed"
                                                    Value="0" />
                                                <TextBlock
                                                    x:Name="LblProg"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    FontWeight="SemiBold"
                                                    Foreground="White"
                                                    IsHitTestVisible="False"
                                                    Text="-" />
                                            </Grid>
                                        </Border>

                                        <!--  Dòng 2  -->
                                        <Border
                                            Grid.Row="1"
                                            Grid.ColumnSpan="2"
                                            Padding="0"
                                            Style="{StaticResource GhostCell}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" Style="{StaticResource GhostQFirst}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="KẾT QUẢ" />
                                                </Border>

                                                <Border Grid.Column="1" Style="{StaticResource GhostQMid}">
                                                    <Grid
                                                        x:Name="CellKetQua"
                                                        Margin="0,0,0,0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">
                                                        <Image
                                                            x:Name="ImgKetQua"
                                                            Height="25"
                                                            Stretch="Uniform"
                                                            Visibility="Collapsed" />
                                                        <TextBlock
                                                            x:Name="LblKetQua"
                                                            Style="{StaticResource ValueText}"
                                                            Text="-" />
                                                    </Grid>
                                                </Border>

                                                <Border Grid.Column="2" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="THẮNG/THUA" />
                                                </Border>

                                                <Border Grid.Column="3" Style="{StaticResource GhostQMid}">
                                                    <Grid
                                                        x:Name="CellThangThua"
                                                        Margin="8,0,0,0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">
                                                        <Image
                                                            x:Name="ImgThangThua"
                                                            Height="25"
                                                            Stretch="Uniform"
                                                            Visibility="Collapsed" />
                                                        <TextBlock
                                                            x:Name="LblWinLoss"
                                                            Style="{StaticResource ValueText}"
                                                            Text="" />
                                                    </Grid>
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!--  Dòng 3  -->
                                        <Border
                                            Grid.Row="2"
                                            Grid.ColumnSpan="2"
                                            Padding="0"
                                            Style="{StaticResource GhostCell}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" Style="{StaticResource GhostQFirst}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="CỬA ĐẶT" />
                                                </Border>

                                                <Border Grid.Column="1" Style="{StaticResource GhostQMid}">
                                                    <Grid
                                                        x:Name="CellCuaDat"
                                                        Margin="8,0,0,0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center">
                                                        <Image
                                                            x:Name="ImgSide"
                                                            Height="25"
                                                            Stretch="Uniform"
                                                            Visibility="Collapsed" />
                                                        <TextBlock
                                                            x:Name="LblSide"
                                                            Style="{StaticResource ValueText}"
                                                            Text="" />
                                                    </Grid>
                                                </Border>

                                                <Border Grid.Column="2" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="TIỀN CƯỢC" />
                                                </Border>

                                                <Border Grid.Column="3" Style="{StaticResource GhostQLast}">
                                                    <TextBlock
                                                        x:Name="LblStake"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Style="{StaticResource ValueText}"
                                                        Text="0" />
                                                </Border>
                                            </Grid>
                                        </Border>

                                        <!--  Dòng 4  -->
                                        <Border
                                            Grid.Row="3"
                                            Grid.ColumnSpan="2"
                                            Padding="0"
                                            Style="{StaticResource GhostCell}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" Style="{StaticResource GhostQFirst}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="MỨC TIỀN" />
                                                </Border>

                                                <Border Grid.Column="1" Style="{StaticResource GhostQLast}">
                                                    <TextBlock
                                                        x:Name="LblLevel"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Style="{StaticResource ValueText}"
                                                        Text="" />
                                                </Border>

                                                <Border Grid.Column="2" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="TIỀN THẮNG" />
                                                </Border>

                                                <Border Grid.Column="3" Style="{StaticResource GhostQLast}">
                                                    <TextBlock
                                                        x:Name="LblWin"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Style="{StaticResource ValueText}"
                                                        Text="0" />
                                                </Border>
                                            </Grid>
                                        </Border>
                                        <!--  DÒNG MỚI: TÊN + MỨC TIỀN (bên dưới TÀI KHOẢN/TIỀN THẮNG, trên CHUỖI KẾT QUẢ)  -->
                                        <Border
                                            Grid.Row="4"
                                            Grid.ColumnSpan="2"
                                            Padding="0"
                                            Style="{StaticResource GhostCell}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!--  TÊN  -->
                                                <Border Grid.Column="0" Style="{StaticResource GhostQFirst}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="TÊN NHÂN VẬT" />
                                                </Border>
                                                <Border Grid.Column="1" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        x:Name="LblUserName"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Style="{StaticResource ValueText}"
                                                        Text="" />
                                                </Border>

                                                <!--  Tài khoản (index + 1 trong chuỗi tiền)  -->
                                                <Border Grid.Column="2" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource CapsLabel}"
                                                        Text="TÀI KHOẢN" />
                                                </Border>
                                                <Border Grid.Column="3" Style="{StaticResource GhostQMid}">
                                                    <TextBlock
                                                        x:Name="LblAmount"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Foreground="#000000"
                                                        Style="{StaticResource ValueText}"
                                                        Text="0">
                                                        <TextBlock.Effect>
                                                            <DropShadowEffect
                                                                BlurRadius="1.0"
                                                                Opacity="1"
                                                                ShadowDepth="1"
                                                                Color="Gold" />
                                                        </TextBlock.Effect>
                                                    </TextBlock>
                                                </Border>
                                            </Grid>
                                        </Border>



                                        <!--  Dòng 5  -->
                                        <Border
                                            Grid.Row="5"
                                            Grid.Column="0"
                                            Style="{StaticResource GhostCell}">
                                            <TextBlock
                                                VerticalAlignment="Center"
                                                Style="{StaticResource CapsLabel}"
                                                Text="CHUỖI KẾT QUẢ" />
                                        </Border>
                                        <Border
                                            Grid.Row="5"
                                            Grid.Column="1"
                                            Style="{StaticResource GhostCell}">
                                            <ItemsControl x:Name="SeqIcons" VerticalAlignment="Center">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel Orientation="Horizontal" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemContainerStyle>
                                                    <Style TargetType="ContentPresenter">
                                                        <Setter Property="Margin" Value="1,0" />
                                                    </Style>
                                                </ItemsControl.ItemContainerStyle>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="{x:Type local:SeqIconVM}">
                                                        <Image
                                                            x:Name="Icon"
                                                            Width="20"
                                                            Height="20"
                                                            Opacity="1"
                                                            Source="{Binding Img}">
                                                            <Image.CacheMode>
                                                                <BitmapCache />
                                                            </Image.CacheMode>
                                                        </Image>
                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding IsLatest}" Value="True">
                                                                <DataTrigger.EnterActions>
                                                                    <BeginStoryboard x:Name="FadeSink">
                                                                        <Storyboard RepeatBehavior="Forever">
                                                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Icon" Storyboard.TargetProperty="Opacity">
                                                                                <EasingDoubleKeyFrame KeyTime="0:0:0.0" Value="1.0" />
                                                                                <EasingDoubleKeyFrame KeyTime="0:0:1.5" Value="0.2">
                                                                                    <EasingDoubleKeyFrame.EasingFunction>
                                                                                        <SineEase EasingMode="EaseIn" />
                                                                                    </EasingDoubleKeyFrame.EasingFunction>
                                                                                </EasingDoubleKeyFrame>
                                                                                <DiscreteDoubleKeyFrame KeyTime="0:0:2" Value="0.2" />
                                                                                <EasingDoubleKeyFrame KeyTime="0:0:4.0" Value="1.0">
                                                                                    <EasingDoubleKeyFrame.EasingFunction>
                                                                                        <SineEase EasingMode="EaseOut" />
                                                                                    </EasingDoubleKeyFrame.EasingFunction>
                                                                                </EasingDoubleKeyFrame>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </DataTrigger.EnterActions>
                                                                <DataTrigger.ExitActions>
                                                                    <StopStoryboard BeginStoryboardName="FadeSink" />
                                                                </DataTrigger.ExitActions>
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Border>

                                    </Grid>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!--  Console  -->
                        <Border
                            x:Name="GroupConsole"
                            Style="{StaticResource Card}"
                            Visibility="Collapsed">
                            <StackPanel>

                                <!--  Header  -->
                                <StackPanel Style="{StaticResource SectionHeader}">
                                    <TextBlock Style="{StaticResource SectionTitle}" Text="Lịch sử cược" />
                                </StackPanel>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <DataGrid
                                        x:Name="BetGrid"
                                        Grid.Row="0"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        CanUserResizeColumns="False"
                                        ColumnWidth="*"
                                        HeadersVisibility="Column"
                                        IsReadOnly="True"
                                        ItemsSource="{Binding}"
                                        Style="{StaticResource LogGrid_BlueTint}">

                                        <DataGrid.Columns>
                                            <!--  Thời gian  -->
                                            <DataGridTextColumn
                                                Width="*"
                                                Binding="{Binding At, StringFormat={}{0:HH:mm:ss dd/MM}}"
                                                Header="Thời gian">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextAlignment" Value="Center" />
                                                        <Setter Property="VerticalAlignment" Value="Center" />
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!--  Tiền cược  -->
                                            <DataGridTextColumn
                                                Width="*"
                                                Binding="{Binding Stake, StringFormat=N0}"
                                                Header="Tiền cược">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextAlignment" Value="Center" />
                                                        <Setter Property="VerticalAlignment" Value="Center" />
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <!--  Cửa đặt  -->
                                            <DataGridTemplateColumn Width="*" Header="Cửa đặt">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Grid VerticalAlignment="Center">
                                                            <Image
                                                                x:Name="ImgSide"
                                                                Height="32"
                                                                Source="{Binding Side, Converter={StaticResource SideToIcon}}"
                                                                Visibility="Visible" />
                                                            <TextBlock
                                                                x:Name="TxtSide"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding Side}"
                                                                Visibility="Collapsed" />
                                                        </Grid>
                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding ElementName=ImgSide, Path=Source}" Value="{x:Null}">
                                                                <Setter TargetName="ImgSide" Property="Visibility" Value="Collapsed" />
                                                                <Setter TargetName="TxtSide" Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>

                                            <!--  Kết quả  -->
                                            <DataGridTemplateColumn Width="*" Header="Kết quả">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Grid VerticalAlignment="Center">
                                                            <Image
                                                                x:Name="ImgKq"
                                                                Height="32"
                                                                Source="{Binding Result, Converter={StaticResource KetQuaToIcon}}"
                                                                Visibility="Visible" />
                                                            <TextBlock
                                                                x:Name="TxtKq"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding Result}"
                                                                Visibility="Collapsed" />
                                                        </Grid>
                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding ElementName=ImgKq, Path=Source}" Value="{x:Null}">
                                                                <Setter TargetName="ImgKq" Property="Visibility" Value="Collapsed" />
                                                                <Setter TargetName="TxtKq" Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>

                                            <!--  Thắng/Thua  -->
                                            <DataGridTemplateColumn Width="*" Header="Thắng/Thua">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border
                                                            x:Name="Badge"
                                                            Padding="6,2"
                                                            CornerRadius="6">
                                                            <Grid VerticalAlignment="Center">
                                                                <Image
                                                                    x:Name="ImgWL"
                                                                    Height="32"
                                                                    Source="{Binding WinLose, Converter={StaticResource WinLossToIcon}}"
                                                                    Visibility="Visible" />
                                                                <TextBlock
                                                                    x:Name="TxtWL"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Text="{Binding WinLose}"
                                                                    Visibility="Collapsed" />
                                                            </Grid>
                                                        </Border>
                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding ElementName=ImgWL, Path=Source}" Value="{x:Null}">
                                                                <Setter TargetName="ImgWL" Property="Visibility" Value="Collapsed" />
                                                                <Setter TargetName="TxtWL" Property="Visibility" Value="Visible" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding WinLose}" Value="Thắng">
                                                                <Setter TargetName="Badge" Property="Background" Value="{StaticResource WinBg}" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding WinLose}" Value="Thua">
                                                                <Setter TargetName="Badge" Property="Background" Value="{StaticResource LossBg}" />
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>

                                            <!--  Tài khoản  -->
                                            <DataGridTextColumn
                                                Width="*"
                                                Binding="{Binding Account, StringFormat=N0}"
                                                Header="Tài khoản">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextAlignment" Value="Center" />
                                                        <Setter Property="VerticalAlignment" Value="Center" />
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>


                                    <!--  Thanh phân trang  -->
                                    <!--  NEW: Newest-First Toolbar  -->
                                    <ToolBarTray Grid.Row="1" Margin="0,6,0,0">
                                        <ToolBar>
                                            <!--  Về trang mới nhất (trang 1)  -->
                                            <Button
                                                x:Name="BtnGoNewest"
                                                Padding="10,4"
                                                Click="BtnGoNewest_Click">
                                                ⟲ Mới nhất
                                            </Button>

                                            <Separator />

                                            <!--  Điều hướng: Trang 1 là mới nhất nên "Mới hơn" dùng Prev, "Cũ hơn" dùng Next  -->
                                            <Button
                                                x:Name="BtnNewer"
                                                Padding="10,4"
                                                Click="BtnPrevPage_Click">
                                                ↑ Mới hơn
                                            </Button>

                                            <!--  Nhãn 1/N  -->
                                            <TextBlock
                                                x:Name="LblPage"
                                                Margin="8,0"
                                                VerticalAlignment="Center"
                                                Text="1/1" />

                                            <Button
                                                x:Name="BtnOlder"
                                                Padding="10,4"
                                                Click="BtnNextPage_Click">
                                                ↓ Cũ hơn
                                            </Button>

                                            <Separator />

                                            <!--  Kích thước trang  -->
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <TextBlock
                                                    Margin="0,0,4,0"
                                                    VerticalAlignment="Center"
                                                    Text="Hiển thị:" />
                                                <ComboBox
                                                    x:Name="CmbPageSize"
                                                    Width="110"
                                                    SelectionChanged="CmbPageSize_SelectionChanged">
                                                    <ComboBoxItem
                                                        Content="10 / trang"
                                                        IsSelected="True"
                                                        Tag="10" />
                                                    <ComboBoxItem Content="20 / trang" Tag="20" />
                                                    <ComboBoxItem Content="50 / trang" Tag="50" />
                                                    <ComboBoxItem Content="100 / trang" Tag="100" />
                                                    <ComboBoxItem Content="500 / trang" Tag="500" />
                                                    <ComboBoxItem Content="1000 / trang" Tag="1000" />
                                                </ComboBox>
                                            </StackPanel>

                                            <Separator />

                                            <!--  Nhảy nhanh tới trang  -->
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <TextBlock
                                                    Margin="0,0,4,0"
                                                    VerticalAlignment="Center"
                                                    Text="Tới:" />
                                                <TextBox
                                                    x:Name="TxtGoto"
                                                    Width="56"
                                                    KeyDown="TxtGoto_KeyDown" />
                                                <Button
                                                    x:Name="BtnGoto"
                                                    Margin="4,0,0,0"
                                                    Click="BtnGoto_Click"
                                                    Content="OK" />
                                            </StackPanel>
                                        </ToolBar>
                                    </ToolBarTray>

                                    <!--  Giữ PagerPanel để code cũ không lỗi, nhưng ẩn đi  -->
                                    <WrapPanel
                                        x:Name="PagerPanel"
                                        Grid.Row="1"
                                        VerticalAlignment="Center"
                                        Visibility="Collapsed" />



                                </Grid>
                            </StackPanel>
                        </Border>





                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </DockPanel>
</Window>
