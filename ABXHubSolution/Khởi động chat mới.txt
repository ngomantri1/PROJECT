Project : BaccaratPPRR88
Dưới đây là tóm tắt bối cảnh từ một chat cũ.
Hãy coi như bạn đã đọc toàn bộ lịch sử và code tương ứng, nhưng chỉ dùng thông tin trong tóm tắt này:

Mục tiêu chính của project / bug
Bảo vệ và mở rộng HomeWatch overlay theo dõi lobby Baccarat/PP RR88: chặn telemetry, giữ TextMap dịch, auto đóng popup, cập nhật username/balance, quét/render overlay multi-table với countdown/multi-card.
Fix nghiệp vụ “Danh sách bàn”: JS gửi list lobby (~45 bàn), UI phải hiện đủ list + đánh dấu bàn đã lưu config; tránh wipe selection khi refresh list rác.
Ghim bàn: đồng bộ 1 chiều từ danh sách bàn được chọn → trạng thái ghim bàn; không sync ngược.
Dùng ID ổn định (id TileHeight-...) để định danh bàn; bỏ dùng name làm key.
Nút “Dump Bacc3” log ra ID ổn định để kiểm tra.
Tech stack (ngôn ngữ, framework, DB…)
JavaScript thuần injected trong WebView2 (C# WPF host).
C# WPF (MainWindow.xaml/.cs), WebView2 bridge JS/C#.
Config lưu config.json UTF-8.
Các file / module quan trọng đang liên quan
js_home_v2.js: overlay, lobby scan, sync pin, scroll, Dump Bacc3.
MainWindow.xaml.cs: load/save config, room list, selection, pin sync JS.
MainWindow.xaml: UI RoomList/Checkbox.
Logic chính đã thiết kế (tên hàm, class, luồng xử lý)
JS (js_home_v2.js)
ID/Card root:
CARD_ID_ATTRS, resolveCardRoot(node), getCardId(root).
findCardRootByName(id) ưu tiên document.getElementById(id) rồi fallback theo title.
Overlay/pin:
pinRooms(list) → setDesiredPinList(list).
setDesiredPinList() lưu desiredPinIds, gọi syncPinStates() và bật timer.
ensurePinState(roomId, shouldPin) tìm card→pin button → click nếu cần, có retry.
pinSyncTick() đọc danh sách pin thực tế và ép theo danh sách chọn.
enforceDesiredPins(desiredList, actualList) đảm bảo 1 chiều (không gửi pinList ngược).
Scroll:
scrollCardIntoView(roomId); scrollLobbyTop() dùng nhiều container scrollable.
Dump:
collectBaccarat3Cards(), extractBaccCardId(card), dumpBaccarat3Characters(), window.__abxDumpBaccarat3Characters.
Overlay/rooms:
normalizeRooms(list) nhận {id,name} hoặc string → chuẩn hóa.
applyRooms() tạo panel, gọi setDesiredPinList(rooms).
C# (MainWindow.xaml.cs)
Model:
RoomEntry { Id, Name } với [JsonPropertyName].
RoomOption { Id, Name, IsSelected }.
Room list:
_roomList: ObservableCollection<RoomEntry>
_selectedRooms: HashSet<string> lưu ID.
RefreshRoomListAsync():
JS scan trả {id,name} (id lấy từ id/data-*).
Clean/dedupe theo ID; filter tên rác; map selection cũ (name→id).
RebuildRoomOptions():
RoomOption.IsSelected dựa trên ID.
SyncSelectedRoomsFromOptions():
Lưu _selectedRooms bằng ID → _cfg.SelectedRooms.
SpawnTableOverlayAsync():
Gửi list {id,name} sang JS.
ScrollRoomIntoViewAsync(id):
JS scroll theo ID.
Pin sync:
SyncSelectedRoomsPinsAsync() → JS pinRooms([id]).
ApplyPinnedRoomsFromWebAsync() vẫn còn nhưng JS đã ngừng gửi pinList (1 chiều).
Những lỗi đã gặp & nguyên nhân chính
Danh sách bàn sai/ít: _roomList từng prefill từ _selectedRooms khi list rỗng, refresh rác ghi đè config.
Ghim bàn khó xác định: tail thay đổi, click sai phần tử; cần nhận diện đúng icon ghim (góc phải trên).
Countdown/overlay mượt chưa ổn định, cần sync theo card root chính xác.
Một số bàn không ghim được khi bị khuất: do click DOM ngoài viewport.
Các giải pháp đã thử, giải pháp hiện tại đang dùng
Tách _roomList và _selectedRooms, chặn list rác (check lobby + URL), giữ selection khi list trống.
JS pin: tìm pin icon theo div.rO_rP top-right, click bằng event dispatch + retry.
Đồng bộ pin theo danh sách chọn 1 chiều (không sync ngược).
Dùng ID ổn định (TileHeight-...) làm key; fallback name chỉ hiển thị.
Việc còn dang dở / TODO
(Nếu cần) loại bỏ hẳn ApplyPinnedRoomsFromWebAsync hoặc để yên (JS không gửi pinList nữa).
Theo dõi nếu DOM thay đổi:
resolveCardRoot/CARD_ID_ATTRS/PIN_SELECTORS cần update.
Kiểm tra Dump Bacc3/scan lobby nếu ID đổi format mới.


Lưy ý : Kiểm tra và sửa lại code cho chính xác, chỉ sửa phần thay đổi của file
Đọc/ghi file bằng UTF-8, Encoding UTF8, viết code chuẩn UTF-8
Giao tiếp bằng tiếng việt

Giờ tôi cần bạn nghiên cứu cho tôi giải pháp để có thể lấy được chuỗi kết quả từ bảng kết quả
Hiện tại bảng kết quả được vẽ trên table.nM_nR vẽ dạng  SVG. Các phần tử tôi không lấy được mà chỉ lấy được được thông tin bảng gồm bao nhiêu cột, bao nhiêu hàng rồi ô nào chưa dữ liệu thôi còn không biết được bên trong nó là banker hay player
Code thì trong file jstest.js bạn đọc rà soát và kiểm tra xem nguyên nhân đến từ đâu. 